(function(n){n.fn.fileUpload=function(t){var r=n.extend({itemId:"",parentId:"",imageUrl:"",uploadUrl:"",deleteUrl:"",acceptedFiles:"image/*",onUploadSuccessCallback:function(){},onDeleteSuccessCallback:function(){}},t),u=this,f=r.itemId,c=r.parentId,o=r.imageUrl,l=r.uploadUrl,a=r.deleteUrl,v=r.acceptedFiles,y=r.onUploadSuccessCallback,p=r.onDeleteSuccessCallback,i={uploader:n(".image-uploader-zone",u),instruction:n(".image-uploader-instruction",u),footer:n(".image-uploader-footer",u),progressSpinner:n(".image-progress-spinner",u),progressMessage:n(".image-progress-message",u),errorMessage:n(".image-error-message",u),deleteButton:n(".image-delete-button",u)},s=function(){return n("input[name=__RequestVerificationToken]").val()},w=function(n,t){i.progressSpinner.hide();i.deleteButton.show();e(t.url);f=t.itemId;y(n,t)},e=function(n){n?(i.instruction.hide(),i.uploader.css("background-image","url('"+n+"')")):(i.instruction.show(),i.uploader.css("background-image","none"))},b=function(t){i.progressSpinner.show();i.progressMessage.text("Deleting...");i.errorMessage.hide();i.deleteButton.hide();n.ajax({type:"POST",url:t,data:{__RequestVerificationToken:s(),itemId:f},dataType:"json",success:k,error:h})},k=function(){e();i.errorMessage.hide();i.deleteButton.hide();i.progressSpinner.hide();p()},h=function(n){i.progressSpinner.hide();i.errorMessage.text(n.responseJSON.error);i.errorMessage.show()};return i.uploader.dropzone({url:l,acceptedFiles:v,sending:function(n,t,r){i.errorMessage.hide();i.progressSpinner.show();i.progressMessage.text("Uploading...");r.append("__RequestVerificationToken",s());r.append("itemId",f);r.append("parentId",c)},success:w,error:h}),o.length>0&&(e(o),i.deleteButton.show()),i.deleteButton.click(function(){b(a)}),i.instruction.click(function(){i.uploader.click()}),this}})(jQuery);